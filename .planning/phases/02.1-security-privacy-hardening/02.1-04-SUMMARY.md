---
phase: 02.1-security-privacy-hardening
plan: 04
subsystem: ui, data
tags: [localStorage, validation, geocoding, privacy, data-limits]

# Dependency graph
requires:
  - phase: 02.1-02
    provides: local postcode geocoding service
  - phase: 02.1-03
    provides: encrypted storage, postcode-based types
provides:
  - ClearDataButton for user data control
  - File size validation (5MB limit)
  - Data count limits (1000 employees, 20 offices)
  - Postcode-based seed data with local geocoding
  - CSV import with synchronous local geocoding
affects: [03-distance-intelligence, data-export]

# Tech tracking
tech-stack:
  added: []
  patterns: [local geocoding for all data sources, data limits enforcement]

key-files:
  created:
    - src/components/ClearDataButton.tsx
  modified:
    - src/components/import/CsvUploader.tsx
    - src/data/seedOffices.ts
    - src/data/seedEmployees.ts
    - src/services/csvService.ts
    - src/components/import/ImportPanel.tsx
    - src/App.tsx

key-decisions:
  - "ClearDataButton clears localStorage, sessionStorage, and Zustand stores then reloads"
  - "File size check before FileReader.readAsText for early rejection"
  - "Data limits checked before import, not during parsing"
  - "Seed employees use local geocoding - no fake clustering near offices"
  - "CSV import handles both postcode column and address extraction for backward compatibility"

patterns-established:
  - "Data limits enforced at import boundaries (ImportPanel), not stores"
  - "All geocoding now uses synchronous local service - no network calls"
  - "Privacy controls (badge, clear button) in sidebar footer"

# Metrics
duration: 3min
completed: 2026-02-07
---

# Phase 02.1 Plan 04: Data Control & Migration Summary

**ClearDataButton with localStorage wipe, 5MB file limit, data count limits, and complete migration to postcode-based local geocoding**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-07T10:00:54Z
- **Completed:** 2026-02-07T10:04:00Z
- **Tasks:** 4
- **Files modified:** 7

## Accomplishments
- ClearDataButton enables users to wipe all stored data with confirmation
- File size validation rejects CSV files larger than 5MB before reading
- Import enforces 1000 employee and 20 office limits
- Seed data migrated to postcode format with local geocoding
- CSV parsing now uses synchronous local geocoding (no network calls)
- PrivacyBadge and ClearDataButton visible in sidebar

## Task Commits

Each task was committed atomically:

1. **Task 1: Create ClearDataButton and add file size limit** - `cacbd10` (feat)
2. **Task 2: Update seed data to postcode format** - `fb7ee70` (feat)
3. **Task 3: Update CSV parsing and import to use local geocoding with limits** - `42e8f20` (feat)
4. **Task 4: Wire up PrivacyBadge and ClearDataButton in App** - `fb24087` (feat)

## Files Created/Modified
- `src/components/ClearDataButton.tsx` - Button to wipe all data with confirmation
- `src/components/import/CsvUploader.tsx` - Added 5MB file size check before read
- `src/data/seedOffices.ts` - Migrated to postcode, street, city format
- `src/data/seedEmployees.ts` - Uses local geocoding for postcode coordinates
- `src/services/csvService.ts` - Postcode extraction, local geocoding integration
- `src/components/import/ImportPanel.tsx` - Data limits check, simplified sync flow
- `src/App.tsx` - Added PrivacyBadge and ClearDataButton to sidebar

## Decisions Made
- ClearDataButton clears stores first, then localStorage.clear() and sessionStorage.clear(), then reloads - ensures clean slate
- Seed employees no longer cluster around office coordinates - use real postcode centroids for authenticity
- CSV import accepts both dedicated postcode column and extraction from address column for backward compatibility
- Removed ImportProgress component usage - local geocoding is instant, no progress needed

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None - all type migrations from Plan 02.1-03 aligned correctly.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Phase 02.1 Security & Privacy Hardening complete
- All data now uses privacy-first postcode-centroid geocoding
- Build passes, app runs with full functionality
- Ready for Phase 03: Distance & Intelligence

## Self-Check: PASSED

---
*Phase: 02.1-security-privacy-hardening*
*Completed: 2026-02-07*
