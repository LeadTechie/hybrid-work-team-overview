---
phase: 02.1-security-privacy-hardening
plan: 05
status: complete
started: 2026-02-07T10:05:00Z
completed: 2026-02-07T10:15:00Z
duration: 10 min

key-files:
  created:
    - src/services/geocodingService.ts (updated for user-provided API key)
    - src/components/AccurateGeocodingModal.tsx
    - src/components/ReloadTestDataButton.tsx
  modified:
    - src/App.tsx
    - src/data/seedEmployees.ts
    - src/components/tables/OfficesTable.tsx
    - src/components/tables/EmployeesTable.tsx

commits:
  - hash: 2658381
    message: "feat(02.1-05): update geocoding service for user-provided API key"
  - hash: 285bdb8
    message: "feat(02.1-05): create AccurateGeocodingModal component"
  - hash: 02dfb9f
    message: "feat(02.1-05): add reload test data button and fix seed geocoding"
  - hash: 9cecbcc
    message: "feat(02.1-05): update tables to show postcode, street, city columns"
---

## Summary

Created opt-in accurate geocoding with GDPR-compliant consent modal and user-provided API key. Added reload test data button and fixed seed data to use valid postcodes. Updated tables to show postcode/street/city columns.

## What Was Built

1. **Geocoding Service Updates** — Removed environment variable API key, added sessionStorage-based key management (getApiKey, setApiKey, clearApiKey, hasApiKey)

2. **AccurateGeocodingModal** — GDPR-compliant consent modal with:
   - Privacy warning about data transfer
   - User-provided API key input
   - Explicit consent checkbox with T&C/Privacy Policy links
   - Equal button prominence (GDPR requirement)

3. **ReloadTestDataButton** — Blue button next to Clear Data that reloads standard test dataset

4. **Seed Data Fix** — seedEmployees.ts now picks from valid German postcodes to ensure 100% geocoding success

5. **Table Updates** — Both OfficesTable and EmployeesTable now show postcode, street, city columns

## Decisions Made

- [02.1-05]: API key stored in sessionStorage only (cleared on tab close)
- [02.1-05]: Seed employees use valid postcodes from bundled database (not faker random)
- [02.1-05]: Tables display '—' for optional empty fields

## Deviations

- Added ReloadTestDataButton (user request during checkpoint)
- Fixed seed data to use valid postcodes (user reported "failed" status)
- Updated table columns to show postcode/street/city (user request)

## Verification

- [x] Build succeeds
- [x] Dev server runs without errors
- [x] All seed employees geocode successfully
- [x] Tables show correct columns
- [x] User approved checkpoint

## Self-Check: PASSED

All must_haves verified:
- ✓ Accurate geocoding requires explicit user consent
- ✓ User must provide their own API key (not bundled)
- ✓ Consent modal has equal button prominence (GDPR)
- ✓ API key stored in sessionStorage only
