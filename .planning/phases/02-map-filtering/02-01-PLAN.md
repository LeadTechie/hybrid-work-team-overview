---
phase: 02-map-filtering
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/stores/filterStore.ts
  - src/utils/markerColors.ts
  - src/utils/markerIcons.ts
autonomous: true

must_haves:
  truths:
    - "Filter state can be read and updated from any component"
    - "Color palette covers all expected teams, departments, and offices"
  artifacts:
    - path: "src/stores/filterStore.ts"
      provides: "Filter state management"
      exports: ["useFilterStore"]
    - path: "src/utils/markerColors.ts"
      provides: "Color palette for teams, departments, offices"
      exports: ["TEAM_COLORS", "getColorForEmployee"]
    - path: "src/utils/markerIcons.ts"
      provides: "Leaflet icon factory functions"
      exports: ["createEmployeeIcon", "createOfficeIcon"]
  key_links:
    - from: "src/utils/markerColors.ts"
      to: "src/utils/markerIcons.ts"
      via: "color passed to icon creation"
      pattern: "createEmployeeIcon.*color"
---

<objective>
Install react-leaflet dependencies and create foundation utilities for Phase 2 map visualization.

Purpose: Establishes the filter state management and marker styling infrastructure that all subsequent map and filter components will use.

Output:
- Installed packages: react-leaflet, leaflet, react-leaflet-cluster, use-debounce, @types/leaflet
- filterStore.ts with filter state and setters
- markerColors.ts with team/department/office color palettes
- markerIcons.ts with L.divIcon factory functions for employees and offices
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-map-filtering/02-RESEARCH.md

@src/types/employee.ts
@src/types/office.ts
@src/stores/employeeStore.ts
@src/stores/officeStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-leaflet dependencies</name>
  <files>package.json</files>
  <action>
Install required packages for mapping and filtering:

```bash
npm install react-leaflet leaflet react-leaflet-cluster use-debounce
npm install -D @types/leaflet
```

Verify installation by checking package.json includes:
- react-leaflet (^5.x)
- leaflet (^1.9.x)
- react-leaflet-cluster (^2.x)
- use-debounce (^10.x)
- @types/leaflet (devDependencies)
  </action>
  <verify>Run `npm ls react-leaflet leaflet react-leaflet-cluster use-debounce` - all packages should show installed versions</verify>
  <done>All five packages installed and visible in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create filter store with Zustand</name>
  <files>src/stores/filterStore.ts</files>
  <action>
Create filterStore following the pattern from 02-RESEARCH.md Pattern 3.

Store interface:
- teamFilter: string | null
- departmentFilter: string | null
- officeFilter: string | null
- searchQuery: string
- colorBy: 'team' | 'department' | 'assignedOffice'
- selectedEmployeeId: string | null (for flyTo highlight)

Actions:
- setTeamFilter(team: string | null)
- setDepartmentFilter(dept: string | null)
- setOfficeFilter(office: string | null)
- setSearchQuery(query: string)
- setColorBy(colorBy: 'team' | 'department' | 'assignedOffice')
- setSelectedEmployeeId(id: string | null)
- clearFilters() - resets all filters except colorBy

Default colorBy to 'team'. Do NOT add persist middleware (filter state is session-only).
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit src/stores/filterStore.ts`</verify>
  <done>filterStore exports useFilterStore with all filter state and setters</done>
</task>

<task type="auto">
  <name>Task 3: Create marker color utilities</name>
  <files>src/utils/markerColors.ts, src/utils/markerIcons.ts</files>
  <action>
Create two utility files:

**markerColors.ts:**
- Export TEAM_COLORS: Record&lt;string, string&gt; with 8 distinct colors (Platform, Frontend, Backend, Mobile, DevOps, QA, Data, Security + default)
- Export DEPARTMENT_COLORS: Record&lt;string, string&gt; with colors for Engineering, Product, Design, Operations, HR, Finance, Marketing + default
- Export OFFICE_COLORS: Record&lt;string, string&gt; with colors for 5 German offices (Berlin, Munich, Hamburg, Frankfurt, Cologne + default)
- Export getColorForEmployee(employee: Employee, colorBy: 'team' | 'department' | 'assignedOffice'): string

Use distinct, accessible colors. Include a DEFAULT_COLOR fallback.

**markerIcons.ts:**
- Import L from 'leaflet'
- Export createEmployeeIcon(color: string, isHighlighted?: boolean): L.DivIcon
  - Use inline SVG marker pin shape (from research Pattern 1)
  - Size 25px normal, 35px highlighted
  - White stroke, colored fill
- Export createOfficeIcon(): L.DivIcon
  - Use inline SVG building shape (from research Pattern 2)
  - Size 32px, dark blue (#1a365d) fill
  - White stroke and window details

Both icons must have proper iconAnchor at bottom center and popupAnchor above.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit src/utils/markerColors.ts src/utils/markerIcons.ts`</verify>
  <done>Color palette and icon factories are complete with all exports</done>
</task>

</tasks>

<verification>
1. Run `npm ls react-leaflet leaflet` - packages installed
2. Run `npx tsc --noEmit` - no TypeScript errors
3. Verify filterStore.ts exports useFilterStore
4. Verify markerColors.ts exports TEAM_COLORS, getColorForEmployee
5. Verify markerIcons.ts exports createEmployeeIcon, createOfficeIcon
</verification>

<success_criteria>
- All packages installed successfully
- filterStore manages filter state with clear/set operations
- Color utilities provide consistent palette for team/dept/office
- Icon factories create properly anchored Leaflet DivIcons with inline SVG
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-map-filtering/02-01-SUMMARY.md`
</output>
